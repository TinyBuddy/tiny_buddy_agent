# WebSocket客户端使用说明

## 功能概述

这个WebSocket客户端程序允许用户与TinyBuddy的WebSocket服务器进行交互，并支持以下功能：

1. 建立与WebSocket服务器的连接
2. 发送初始化消息
3. 支持两种消息发送模式：
   - 一次性发送完整消息
   - 流式发送消息（逐字发送）
4. 心跳机制保持连接活跃
5. 自动重连机制

## 准备工作

1. 确保已安装所有依赖：
```bash
npm install
```

2. 启动WebSocket服务器：
```bash
npm run dev
```
这将启动服务器并监听ws://localhost:3143端口。

## 运行客户端

在服务器运行的情况下，使用以下命令启动WebSocket客户端：

```bash
node --no-warnings --experimental-specifier-resolution=node ws-client.ts
```

## 可用命令

客户端启动后，可以使用以下命令：

| 命令 | 描述 |
|------|------|
| `exit` | 退出程序 |
| `check` | 检查连接状态 |
| `help` | 显示帮助信息 |
| `stream:<消息>` | 以流式方式发送消息（逐字发送） |
| 直接输入消息 | 一次性发送完整消息 |

## 流式发送功能使用示例

要使用流式发送功能，只需在消息前加上`stream:`前缀：

```
> stream:你好，TinyBuddy!
准备以流式方式发送消息: 你好，TinyBuddy!
开始流式发送消息...
发送: "你"
发送: "好"
发送: "，"
发送: "T"
发送: "i"
发送: "n"
发送: "y"
发送: "B"
发送: "u"
发送: "d"
发送: "d"
发送: "y"
发送: "!"
流式发送完成
>
```

## 技术细节

### 流式发送实现

流式发送功能通过以下机制实现：

1. 将用户输入的文本拆分为单个字符
2. 以固定时间间隔（默认200毫秒）逐字发送到服务器
3. 每条消息包含以下额外字段：
   - `isStreaming: true` - 标识这是流式消息的一部分
   - `isFinal: boolean` - 标识是否为最后一个字符

### 心跳机制

- 客户端每30秒发送一次ping消息
- 服务器应返回pong消息确认
- 如果15秒内未收到pong响应，则认为连接超时
- 连接断开后会自动尝试重连（最多10次）

## 注意事项

1. 确保服务器已启动并运行正常
2. 流式发送功能需要服务器端支持才能正确处理
3. 如果遇到连接问题，请检查网络设置和防火墙配置
4. 使用`exit`命令正常退出程序，以确保资源得到正确清理