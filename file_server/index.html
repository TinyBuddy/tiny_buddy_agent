<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件服务器 - 上传和下载</title>
    <!-- 使用Tailwind CSS进行样式设计 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 使用Font Awesome图标 -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Tailwind配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        dark: '#1e293b',
                        light: '#f8fafc'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <!-- 自定义样式 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .shadow-soft {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .transition-custom {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-inter text-gray-800 min-h-screen">
    <header class="bg-white shadow-md py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-server text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-dark">文件服务器</h1>
            </div>
            <div class="text-sm text-gray-500">
                <i class="fa fa-clock-o mr-1"></i>
                <span id="current-time"></span>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- 文件上传区域 -->
        <section class="bg-white rounded-xl shadow-soft p-6 mb-8 transform hover:scale-[1.01] transition-custom">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-dark flex items-center">
                    <i class="fa fa-cloud-upload text-primary mr-2"></i>
                    文件上传
                </h2>
                <div class="text-sm text-gray-500" id="upload-size-hint">
                    最大上传大小: 500MB
                </div>
            </div>
            
            <form id="upload-form" class="space-y-4">
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-custom" id="drop-area">
                    <i class="fa fa-file-o text-5xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 mb-2">拖放文件到这里，或</p>
                    <label for="file-input" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg inline-block cursor-pointer transition-custom">
                        <i class="fa fa-folder-open mr-2"></i>浏览文件
                    </label>
                    <input type="file" id="file-input" class="hidden" multiple>
                </div>
                
                <div id="file-preview" class="hidden space-y-3">
                    <h3 class="font-medium text-dark">待上传文件:</h3>
                    <div id="file-list" class="space-y-2"></div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-8 py-3 rounded-lg inline-flex items-center transition-custom disabled:opacity-50 disabled:cursor-not-allowed" id="upload-btn" disabled>
                        <i class="fa fa-paper-plane mr-2"></i>开始上传
                    </button>
                </div>
            </form>
        </section>

        <!-- 文件列表区域 -->
        <section class="bg-white rounded-xl shadow-soft p-6 transform hover:scale-[1.01] transition-custom">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-lg font-semibold text-dark flex items-center">
                    <i class="fa fa-folder text-secondary mr-2"></i>
                    可用文件
                </h2>
                <div class="relative">
                    <input type="text" id="search-input" placeholder="搜索文件..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 w-64 transition-custom">
                    <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full min-w-[640px]">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">文件名</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">大小</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">修改日期</th>
                            <th class="py-3 px-4 text-right text-sm font-medium text-gray-600">操作</th>
                        </tr>
                    </thead>
                    <tbody id="file-table-body">
                        <!-- 加载中状态 -->
                        <tr id="loading-row">
                            <td colspan="4" class="py-8 text-center">
                                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                                <p class="mt-2 text-gray-500">正在加载文件列表...</p>
                            </td>
                        </tr>
                        
                        <!-- 文件列表会通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
            
            <!-- 无文件状态 -->
            <div id="empty-state" class="hidden py-12 text-center">
                <i class="fa fa-folder-open-o text-6xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">当前目录中没有文件</p>
                <p class="text-gray-400 text-sm mt-2">上传一些文件来开始使用</p>
            </div>
        </section>
    </main>

    <footer class="bg-white border-t border-gray-200 py-4 mt-8">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>文件服务器 © 2023 | 使用Nginx和现代Web技术构建</p>
        </div>
    </footer>

    <!-- 上传进度模态框 -->
    <div id="upload-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full">
            <h3 class="text-lg font-semibold mb-4">文件上传</h3>
            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1">
                    <span id="upload-current-file">准备上传...</span>
                    <span id="upload-percentage">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="upload-progress-bar" class="bg-primary h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>
            <div class="flex justify-end">
                <button id="cancel-upload" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-custom">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="delete-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full">
            <h3 class="text-lg font-semibold mb-2">确认删除</h3>
            <p class="text-gray-600 mb-6">您确定要删除文件 <span id="delete-filename" class="font-medium"></span> 吗？此操作无法撤销。</p>
            <div class="flex justify-end space-x-3">
                <button id="cancel-delete" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-custom">
                    取消
                </button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-custom">
                    <i class="fa fa-trash mr-1"></i> 删除
                </button>
            </div>
        </div>
    </div>

    <!-- 主脚本 -->
    <script>
        // DOM元素
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const filePreview = document.getElementById('file-preview');
        const fileList = document.getElementById('file-list');
        const uploadBtn = document.getElementById('upload-btn');
        const uploadForm = document.getElementById('upload-form');
        const uploadModal = document.getElementById('upload-modal');
        const uploadProgressBar = document.getElementById('upload-progress-bar');
        const uploadPercentage = document.getElementById('upload-percentage');
        const uploadCurrentFile = document.getElementById('upload-current-file');
        const cancelUpload = document.getElementById('cancel-upload');
        const fileTableBody = document.getElementById('file-table-body');
        const loadingRow = document.getElementById('loading-row');
        const emptyState = document.getElementById('empty-state');
        const searchInput = document.getElementById('search-input');
        const currentTime = document.getElementById('current-time');
        const deleteModal = document.getElementById('delete-modal');
        const deleteFilename = document.getElementById('delete-filename');
        const cancelDelete = document.getElementById('cancel-delete');
        const confirmDelete = document.getElementById('confirm-delete');
        
        // 初始化变量
        let selectedFiles = [];
        let uploadAbortController = null;
        let currentDeleteFile = null;
        
        // 更新当前时间
        function updateCurrentTime() {
            const now = new Date();
            currentTime.textContent = now.toLocaleString('zh-CN');
        }
        
        updateCurrentTime();
        setInterval(updateCurrentTime, 60000);
        
        // 处理文件拖放
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropArea.classList.add('border-primary');
            dropArea.classList.add('bg-primary/5');
        }
        
        function unhighlight() {
            dropArea.classList.remove('border-primary');
            dropArea.classList.remove('bg-primary/5');
        }
        
        // 处理文件选择
        dropArea.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFiles, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles({ target: { files } });
        }
        
        function handleFiles(e) {
            selectedFiles = Array.from(e.target.files);
            showFilePreview();
        }
        
        // 显示文件预览
        function showFilePreview() {
            if (selectedFiles.length === 0) {
                filePreview.classList.add('hidden');
                uploadBtn.disabled = true;
                return;
            }
            
            filePreview.classList.remove('hidden');
            uploadBtn.disabled = false;
            fileList.innerHTML = '';
            
            selectedFiles.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:border-primary/50 transition-custom';
                
                const fileInfo = document.createElement('div');
                fileInfo.className = 'flex items-center';
                
                const fileIcon = document.createElement('i');
                fileIcon.className = getFileIcon(file.name);
                fileIcon.className += ' text-primary mr-3';
                
                const fileDetails = document.createElement('div');
                
                const fileName = document.createElement('p');
                fileName.className = 'font-medium text-sm truncate max-w-xs';
                fileName.textContent = file.name;
                
                const fileSize = document.createElement('p');
                fileSize.className = 'text-gray-500 text-xs';
                fileSize.textContent = formatFileSize(file.size);
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'text-gray-400 hover:text-red-500 transition-custom';
                removeBtn.innerHTML = '<i class="fa fa-times"></i>';
                removeBtn.addEventListener('click', function() {
                    selectedFiles = selectedFiles.filter(f => f.name !== file.name);
                    showFilePreview();
                });
                
                fileDetails.appendChild(fileName);
                fileDetails.appendChild(fileSize);
                fileInfo.appendChild(fileIcon);
                fileInfo.appendChild(fileDetails);
                fileItem.appendChild(fileInfo);
                fileItem.appendChild(removeBtn);
                fileList.appendChild(fileItem);
            });
        }
        
        // 获取文件图标
        function getFileIcon(fileName) {
            const extension = fileName.split('.').pop().toLowerCase();
            const iconMap = {
                pdf: 'fa-file-pdf-o text-red-500',
                doc: 'fa-file-word-o text-blue-500',
                docx: 'fa-file-word-o text-blue-500',
                xls: 'fa-file-excel-o text-green-500',
                xlsx: 'fa-file-excel-o text-green-500',
                ppt: 'fa-file-powerpoint-o text-orange-500',
                pptx: 'fa-file-powerpoint-o text-orange-500',
                jpg: 'fa-file-image-o text-purple-500',
                jpeg: 'fa-file-image-o text-purple-500',
                png: 'fa-file-image-o text-purple-500',
                gif: 'fa-file-image-o text-purple-500',
                svg: 'fa-file-image-o text-purple-500',
                zip: 'fa-file-zip-o text-yellow-500',
                rar: 'fa-file-zip-o text-yellow-500',
                '7z': 'fa-file-zip-o text-yellow-500',
                mp3: 'fa-file-audio-o text-indigo-500',
                wav: 'fa-file-audio-o text-indigo-500',
                mp4: 'fa-file-video-o text-pink-500',
                avi: 'fa-file-video-o text-pink-500',
                mov: 'fa-file-video-o text-pink-500',
                txt: 'fa-file-text-o',
                html: 'fa-file-code-o',
                css: 'fa-file-code-o',
                js: 'fa-file-code-o',
                json: 'fa-file-code-o',
                xml: 'fa-file-code-o',
                sql: 'fa-file-code-o',
                py: 'fa-file-code-o',
                java: 'fa-file-code-o',
                c: 'fa-file-code-o',
                cpp: 'fa-file-code-o',
                cs: 'fa-file-code-o',
                php: 'fa-file-code-o',
                rb: 'fa-file-code-o',
                go: 'fa-file-code-o',
                rs: 'fa-file-code-o'
            };
            
            return iconMap[extension] || 'fa-file-o';
        }
        
        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // 处理文件上传
        uploadForm.addEventListener('submit', function(e) {
            e.preventDefault();
            if (selectedFiles.length === 0) return;
            
            uploadFiles();
        });
        
        function uploadFiles() {
            // 显示上传模态框
            uploadModal.classList.remove('hidden');
            
            let totalUploaded = 0;
            let totalSize = selectedFiles.reduce((sum, file) => sum + file.size, 0);
            let completedFiles = 0;
            
            // 重置进度
            updateUploadProgress(0, '准备上传...');
            
            // 创建AbortController用于取消上传
            uploadAbortController = new AbortController();
            
            // 实际文件上传逻辑
            selectedFiles.forEach((file, index) => {
                // 延迟开始每个文件的上传，避免同时发起多个请求
                setTimeout(() => {
                    // 更新当前上传文件
                    uploadCurrentFile.textContent = `正在上传: ${file.name}`;
                    
                    // 创建FormData对象
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    // 创建XMLHttpRequest对象
                    const xhr = new XMLHttpRequest();
                    
                    // 监听上传进度
                    xhr.upload.addEventListener('progress', function(e) {
                        if (e.lengthComputable) {
                            // 计算当前文件的上传进度
                            const fileProgress = Math.floor((e.loaded / e.total) * 100);
                            // 计算总进度
                            const progress = Math.floor((totalUploaded + e.loaded) / totalSize * 100);
                            updateUploadProgress(progress, `正在上传: ${file.name}`);
                        }
                    });
                    
                    // 监听上传完成
                    xhr.addEventListener('load', function() {
                        if (xhr.status === 200 || xhr.status === 201) {
                            totalUploaded += file.size;
                            completedFiles++;
                            
                            // 检查是否所有文件都上传完成
                            if (completedFiles === selectedFiles.length) {
                                uploadModal.classList.add('hidden');
                                // 清空选择的文件
                                selectedFiles = [];
                                showFilePreview();
                                // 刷新文件列表
                                loadFileList();
                                // 显示成功通知
                                showNotification('文件上传成功！', 'success');
                            }
                        } else {
                            showNotification('文件上传失败: ' + file.name, 'error');
                        }
                    });
                    
                    // 监听上传错误
                    xhr.addEventListener('error', function() {
                        showNotification('文件上传出错: ' + file.name, 'error');
                    });
                    
                    // 监听上传中止
                    xhr.addEventListener('abort', function() {
                        showNotification('上传已取消', 'info');
                    });
                    
                    // 打开连接并发送请求到上传服务器
                    xhr.open('POST', 'http://localhost:8082', true);
                    xhr.send(formData);
                }, index * 500);
            });
        }
        
        // 更新上传进度
        function updateUploadProgress(percentage, fileName) {
            uploadProgressBar.style.width = `${percentage}%`;
            uploadPercentage.textContent = `${percentage}%`;
            if (fileName) {
                uploadCurrentFile.textContent = fileName;
            }
        }
        
        // 取消上传
        cancelUpload.addEventListener('click', function() {
            uploadModal.classList.add('hidden');
            if (uploadAbortController) {
                uploadAbortController.abort();
            }
        });
        
        // 加载文件列表
        function loadFileList() {
            loadingRow.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            // 清空文件表格
            fileTableBody.innerHTML = '';
            
            // 发送请求获取/upload目录中的文件列表
            fetch('./upload/')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('无法获取文件列表');
                    }
                    return response.text();
                })
                .then(html => {
                    // 解析HTML响应，提取文件列表
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const fileLinks = doc.querySelectorAll('a');
                    
                    // 过滤出文件链接（排除父目录链接和index.html）
                    const files = Array.from(fileLinks)
                        .map(link => {
                            const href = link.getAttribute('href');
                            // 排除父目录链接、index.html和upload目录
                            if (href === '../' || href === 'index.html' || href === 'upload/') {
                                return null;
                            }
                            
                            // 尝试从链接文本中提取文件大小和修改日期
                            // Nginx自动索引页面的格式通常是：文件名 大小 修改日期
                            const linkText = link.textContent.trim();
                            const sizeMatch = linkText.match(/(\d+[KMGT]?B)/);
                            const dateMatch = linkText.match(/(\d{4}-\d{2}-\d{2} \d{2}:\d{2})/);
                            
                            return {
                                name: href,
                                size: sizeMatch ? parseFileSize(sizeMatch[0]) : 0,
                                modified: dateMatch ? dateMatch[0] : new Date().toLocaleString('zh-CN')
                            };
                        })
                        .filter(Boolean);
                    
                    loadingRow.classList.add('hidden');
                    
                    if (files.length === 0) {
                        emptyState.classList.remove('hidden');
                        return;
                    }
                    
                    // 添加文件到表格
                    files.forEach(file => {
                        const row = document.createElement('tr');
                        row.className = 'border-b border-gray-200 hover:bg-gray-50 transition-custom';
                        
                        const nameCell = document.createElement('td');
                        nameCell.className = 'py-4 px-4';
                        nameCell.innerHTML = `
                            <div class="flex items-center">
                                <i class="fa ${getFileIcon(file.name).replace('text-primary', 'text-gray-500')} mr-3"></i>
                                <span class="font-medium">${file.name}</span>
                            </div>
                        `;
                        
                        const sizeCell = document.createElement('td');
                        sizeCell.className = 'py-4 px-4 text-gray-600';
                        sizeCell.textContent = formatFileSize(file.size);
                        
                        const dateCell = document.createElement('td');
                        dateCell.className = 'py-4 px-4 text-gray-600';
                        dateCell.textContent = file.modified;
                        
                        const actionCell = document.createElement('td');
                        actionCell.className = 'py-4 px-4 text-right';
                        actionCell.innerHTML = `
                            <button class="bg-secondary hover:bg-secondary/90 text-white px-4 py-1.5 rounded-lg inline-flex items-center text-sm transition-custom mr-2" onclick="downloadFile('${file.name}')">
                                <i class="fa fa-download mr-1"></i> 下载
                            </button>
                            <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-1.5 rounded-lg inline-flex items-center text-sm transition-custom" onclick="showDeleteConfirm('${file.name}')">
                                <i class="fa fa-trash mr-1"></i> 删除
                            </button>
                        `;
                        
                        row.appendChild(nameCell);
                        row.appendChild(sizeCell);
                        row.appendChild(dateCell);
                        row.appendChild(actionCell);
                        fileTableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    loadingRow.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    emptyState.innerHTML = `
                        <i class="fa fa-exclamation-circle text-6xl text-red-400 mb-4"></i>
                        <p class="text-gray-500">无法加载文件列表</p>
                        <p class="text-gray-400 text-sm mt-2">错误: ${error.message}</p>
                    `;
                    console.error('加载文件列表失败:', error);
                });
        }
        
        // 解析文件大小字符串为字节数
        function parseFileSize(sizeStr) {
            const sizeMatch = sizeStr.match(/^(\d+(?:\.\d+)?)([KMG]B)?$/i);
            if (!sizeMatch) return 0;
            
            const size = parseFloat(sizeMatch[1]);
            const unit = sizeMatch[2] ? sizeMatch[2].toUpperCase() : 'B';
            
            const multipliers = {
                'B': 1,
                'KB': 1024,
                'MB': 1024 * 1024,
                'GB': 1024 * 1024 * 1024,
                'TB': 1024 * 1024 * 1024 * 1024
            };
            
            return size * multipliers[unit];
        }
        
        // 下载文件函数
        window.downloadFile = function(filename) {
            // 创建下载链接并触发点击
            const link = document.createElement('a');
            link.href = `./upload/${filename}`;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };
        
        // 显示删除确认对话框
        window.showDeleteConfirm = function(filename) {
            currentDeleteFile = filename;
            deleteFilename.textContent = filename;
            deleteModal.classList.remove('hidden');
        };
        
        // 取消删除
        cancelDelete.addEventListener('click', function() {
            deleteModal.classList.add('hidden');
            currentDeleteFile = null;
        });
        
        // 确认删除
        confirmDelete.addEventListener('click', function() {
            if (!currentDeleteFile) return;
            
            deleteFile(currentDeleteFile);
            deleteModal.classList.add('hidden');
            currentDeleteFile = null;
        });
        
        // 删除文件函数
        function deleteFile(filename) {
            fetch(`http://localhost:8082/${encodeURIComponent(filename)}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('删除请求失败');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    showNotification('文件删除成功！', 'success');
                    // 刷新文件列表
                    loadFileList();
                } else {
                    showNotification('文件删除失败: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('删除文件失败:', error);
                showNotification('文件删除失败: ' + error.message, 'error');
            });
        }
        
        // 显示通知
        function showNotification(message, type = 'info') {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center transition-all duration-300 transform translate-y-10 opacity-0`;
            
            // 设置通知类型样式
            if (type === 'success') {
                notification.classList.add('bg-green-500', 'text-white');
                notification.innerHTML = `<i class="fa fa-check-circle mr-2"></i>${message}`;
            } else if (type === 'error') {
                notification.classList.add('bg-red-500', 'text-white');
                notification.innerHTML = `<i class="fa fa-exclamation-circle mr-2"></i>${message}`;
            } else {
                notification.classList.add('bg-primary', 'text-white');
                notification.innerHTML = `<i class="fa fa-info-circle mr-2"></i>${message}`;
            }
            
            // 添加到页面
            document.body.appendChild(notification);
            
            // 显示通知
            setTimeout(() => {
                notification.classList.remove('translate-y-10', 'opacity-0');
            }, 100);
            
            // 自动关闭通知
            setTimeout(() => {
                notification.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // 搜索功能
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = fileTableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const fileName = row.querySelector('td:first-child span').textContent.toLowerCase();
                if (fileName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            loadFileList();
        });
    </script>
</body>
</html>