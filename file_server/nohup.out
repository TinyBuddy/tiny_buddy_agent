文件上传服务器已启动，监听端口 8082
node:internal/errors:540
      throw error;
      ^

TypeError [ERR_INVALID_ARG_TYPE]: The "path" argument must be of type string. Received undefined
    at Object.basename (node:path:1440:5)
    at /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload_server.js:47:72
    at zalgoSafe (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/dezalgo/dezalgo.js:20:10)
    at f (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/once/once.js:25:25)
    at IncomingForm.<anonymous> (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1212:7)
    at IncomingForm.emit (node:events:518:28)
    at IncomingForm._maybeEnd (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1663:10)
    at /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1422:14
    at Array.<anonymous> (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:88:7)
    at callFinishedCallbacks (node:internal/streams/writable:982:25) {
  code: 'ERR_INVALID_ARG_TYPE'
}

Node.js v22.18.0
文件上传服务器已启动，监听端口 8082
node:internal/errors:540
      throw error;
      ^

TypeError [ERR_INVALID_ARG_TYPE]: The "oldPath" argument must be of type string or an instance of Buffer or URL. Received undefined
    at Object.rename (node:fs:1005:5)
    at /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload_server.js:51:12
    at zalgoSafe (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/dezalgo/dezalgo.js:20:10)
    at f (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/once/once.js:25:25)
    at IncomingForm.<anonymous> (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1212:7)
    at IncomingForm.emit (node:events:518:28)
    at IncomingForm._maybeEnd (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1663:10)
    at /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1422:14
    at Array.<anonymous> (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:88:7)
    at callFinishedCallbacks (node:internal/streams/writable:982:25) {
  code: 'ERR_INVALID_ARG_TYPE'
}

Node.js v22.18.0
文件上传服务器已启动，监听端口 8082
关闭文件上传服务器...
服务器已关闭
文件上传服务器已启动，监听端口 8082
上传的文件对象结构: [
  {
    "size": 66,
    "filepath": "/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/vqfay6q6q1v88tgs6wvldwm7t",
    "newFilename": "vqfay6q6q1v88tgs6wvldwm7t",
    "mimetype": "text/plain",
    "mtime": "2025-10-02T07:10:11.918Z",
    "originalFilename": "download_test.txt"
  }
]
找不到有效的文件路径
关闭文件上传服务器...
服务器已关闭
文件上传服务器已启动，监听端口 8082
文件对象结构: {
  "size": 66,
  "filepath": "/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/lr8qbsgnni3dt2eq7mosv5v7g",
  "newFilename": "lr8qbsgnni3dt2eq7mosv5v7g",
  "mimetype": "text/plain",
  "mtime": "2025-10-02T07:11:15.610Z",
  "originalFilename": "download_test.txt"
}
找到的临时文件路径: /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/lr8qbsgnni3dt2eq7mosv5v7g
文件处理错误: ReferenceError: uploadedFile is not defined
    at /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload_server.js:83:34
    at zalgoSafe (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/dezalgo/dezalgo.js:20:10)
    at f (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/once/once.js:25:25)
    at IncomingForm.<anonymous> (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1212:7)
    at IncomingForm.emit (node:events:518:28)
    at IncomingForm._maybeEnd (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1663:10)
    at /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:1422:14
    at Array.<anonymous> (/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/node_modules/formidable/dist/index.cjs:88:7)
    at callFinishedCallbacks (node:internal/streams/writable:982:25)
    at finish (node:internal/streams/writable:953:3)
关闭文件上传服务器...
服务器已关闭
文件上传服务器已启动，监听端口 8082
文件对象结构: {
  "size": 66,
  "filepath": "/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/vm25491406c1qhyeg1iylj8bi",
  "newFilename": "vm25491406c1qhyeg1iylj8bi",
  "mimetype": "text/plain",
  "mtime": "2025-10-02T07:12:16.488Z",
  "originalFilename": "download_test.txt"
}
找到的临时文件路径: /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/vm25491406c1qhyeg1iylj8bi
文件上传成功: upload_1759389136488.txt
文件对象结构: {
  "size": 66,
  "filepath": "/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/bxdp12mjgsxoh6f0cu0gdu3hf",
  "newFilename": "bxdp12mjgsxoh6f0cu0gdu3hf",
  "mimetype": "text/plain",
  "mtime": "2025-10-02T07:12:27.318Z",
  "originalFilename": "download_test.txt"
}
找到的临时文件路径: /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/bxdp12mjgsxoh6f0cu0gdu3hf
文件上传成功: upload_1759389147318.txt
文件对象结构: {
  "size": 66,
  "filepath": "/Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/byyw7vdsrvz06irqjb57ey8ib",
  "newFilename": "byyw7vdsrvz06irqjb57ey8ib",
  "mimetype": "text/plain",
  "mtime": "2025-10-02T07:17:34.459Z",
  "originalFilename": "download_test.txt"
}
找到的临时文件路径: /Users/harold/webdev/tmp-test/tiny_buddy_agent/file_server/upload/byyw7vdsrvz06irqjb57ey8ib
文件上传成功: upload_1759389454459.txt
文件上传服务器已启动，监听端口 8082
关闭文件上传服务器...
服务器已关闭
